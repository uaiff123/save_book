<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบเช็คอินและสำรวจการใช้ห้องสมุด</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- CSS STYLES --- */

        /* General Body and Scrollbar (unchanged for aesthetics) */
        body {
            background: linear-gradient(90deg, #0f0f0f 0%, #1A0033 60%, #663399 100%);
            min-height: 100vh;
            color: #f0f0f0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 12px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background-color: #6b7280; border-radius: 6px; border: 3px solid #1a1a1a; }
        ::-webkit-scrollbar-thumb:hover { background-color: #9ca3af; }
        * { scrollbar-width: thin; scrollbar-color: #6b7280 #1a1a1a; }

        /* Animated background bubbles (omitted for brevity, but you can paste back the original) */
        /* .bg-bubble styles... */ 
        
        /* Enhanced Gradient Card (Main Container) */
        .gradient-card {
            background: rgba(30, 0, 60, 0.5);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1.5px solid rgba(149, 76, 233, 0.15);
            border-radius: 16px;
            padding: 2.5rem;
            box-shadow: 0 8px 24px rgba(99, 45, 165, 0.1), 0 0 12px rgba(149, 76, 233, 0.2);
            transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
            max-width: 700px; /* เพิ่มขนาดเพื่อรองรับฟอร์มที่ใหญ่ขึ้น */
            margin: 2rem;
            position: relative;
        }

        .gradient-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 36px rgba(99, 45, 165, 0.15), 0 0 20px rgba(149, 76, 233, 0.3);
        }

        /* Enhanced Button */
        .action-btn {
            background: linear-gradient(135deg, #7a39fb 0%, #981bfe 100%);
            border: none;
            border-radius: 8px;
            color: white;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(122, 57, 251, 0.3);
            transition: transform 0.3s, box-shadow 0.3s;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(152, 27, 254, 0.5);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: #c9a8ff;
            font-weight: 500;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.8rem 1rem;
            background: rgba(20, 0, 40, 0.6);
            border: 1px solid rgba(149, 76, 233, 0.3);
            border-radius: 8px;
            color: #f0f0f0;
            font-size: 1rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #7a39fb;
            box-shadow: 0 0 0 3px rgba(122, 57, 251, 0.2);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* Header Styles */
        .page-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .page-logo {
            font-size: 2.2rem;
            font-weight: bold;
            background: linear-gradient(135deg, #7a39fb 0%, #981bfe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .page-subtitle {
            color: #c9d1d9;
            font-size: 1.1rem;
        }

        /* Form Section */
        .form-section {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(149, 76, 233, 0.2);
        }

        .form-section-title {
            color: #c9a8ff;
            font-size: 1.3rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Time Inputs (For 2-column layout) */
        .time-user-row, .year-major-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        /* Satisfaction Rating */
        .rating-container {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
        }

        .rating-item {
            text-align: center;
            flex: 1;
            padding: 0.75rem 0.5rem;
            background: rgba(20, 0, 40, 0.4);
            border-radius: 8px;
            margin: 0 0.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .rating-item:hover {
            background: rgba(122, 57, 251, 0.2);
            transform: translateY(-3px);
        }

        .rating-item.selected {
            background: rgba(122, 57, 251, 0.6); /* สีเข้มขึ้นเมื่อเลือก */
            box-shadow: 0 0 10px rgba(122, 57, 251, 0.7);
            transform: scale(1.05);
        }

        .rating-emoji {
            font-size: 2rem;
            margin-bottom: 0.25rem;
        }

        .rating-text {
            font-size: 0.8rem;
            color: #c9d1d9;
        }
        
        /* Book List */
        .book-list {
            margin-top: 1rem;
        }

        .book-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: rgba(20, 0, 40, 0.4);
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .book-actions button {
            background: none;
            border: none;
            color: #ff6b6b;
            cursor: pointer;
            font-size: 1rem;
            transition: color 0.3s ease;
        }

        .book-actions button:hover {
            color: #ee5a52;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .gradient-card {
                padding: 1.5rem;
                margin: 1rem 0.5rem;
            }
            
            .time-user-row, .year-major-row {
                grid-template-columns: 1fr;
                gap: 0;
            }
            
            .time-user-row .form-group {
                margin-bottom: 1.5rem;
            }

            .rating-container {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .rating-item {
                flex: 0 0 calc(50% - 0.5rem); /* แสดง 2 คอลัมน์บนมือถือ */
                margin: 0.5rem 0.25rem;
            }
        }
    </style>
</head>
<body>
    <div id="survey-container" class="gradient-card">
        <div class="page-header">
            <div class="page-logo"><i class="fas fa-book-reader"></i> ระบบเช็คอินและสำรวจการใช้ห้องสมุด</div>
            <div class="page-subtitle">บันทึกข้อมูลการเข้าใช้และความพึงพอใจ</div>
        </div>
        <hr style="border-color: rgba(149, 76, 233, 0.2); margin: 0 0 2rem 0;">

        <form id="checkin-survey-form">
            
            <div class="form-section">
                <div class="form-section-title">
                    <i class="fas fa-clock"></i> ข้อมูลเวลาเข้าใช้
                </div>
                
                <div class="time-user-row">
                    <div class="form-group">
                        <label class="form-label" for="entry-time">เวลาเข้า</label>
                        <input type="time" id="entry-time" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="exit-time">เวลาออก</label>
                        <input type="time" id="exit-time" class="form-input" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">ระยะเวลาที่ใช้ในห้องสมุด</label>
                    <div id="duration-display" style="padding: 0.8rem; background: rgba(20, 0, 40, 0.4); border-radius: 8px; text-align: center; color: #56d364; font-weight: bold;">
                        กรุณากรอกเวลาเข้าและเวลาออก
                    </div>
                </div>
            </div>

            <div class="form-section">
                <div class="form-section-title">
                    <i class="fas fa-user-graduate"></i> ข้อมูลผู้ใช้งาน
                </div>
                
                <div class="time-user-row">
                    <div class="form-group">
                        <label class="form-label" for="fullname">ชื่อ-นามสกุล</label>
                        <input type="text" id="fullname" class="form-input" placeholder="กรอกชื่อ-นามสกุล" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="student-id">รหัสนักศึกษา</label>
                        <input type="text" id="student-id" class="form-input" placeholder="กรอกรหัสนักศึกษา" required>
                    </div>
                </div>

                <div class="time-user-row">
                    <div class="form-group">
                        <label class="form-label" for="year">ชั้นปี</label>
                        <select id="year" class="form-select" required>
                            <option value="">เลือกชั้นปี</option>
                            <option value="1">ปี 1</option>
                            <option value="2">ปี 2</option>
                            <option value="3">ปี 3</option>
                            <option value="4">ปี 4</option>
                            <option value="อื่นๆ">อื่นๆ</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="major">สาขาวิชา</label>
                        <input type="text" id="major" class="form-input" placeholder="กรอกสาขาวิชา" required>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <div class="form-section-title">
                    <i class="fas fa-book-open"></i> หนังสือที่อ่าน
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="book-title">ชื่อหนังสือ</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" id="book-title" class="form-input" placeholder="กรอกชื่อหนังสือที่อ่าน">
                        <button type="button" id="add-book" class="action-btn" style="white-space: nowrap;">
                            <i class="fas fa-plus"></i> เพิ่ม
                        </button>
                    </div>
                </div>
                
                <div class="book-list" id="book-list">
                    </div>
            </div>

            <div class="form-section">
                <div class="form-section-title">
                    <i class="fas fa-star"></i> ระดับความพึงพอใจ
                </div>
                
                <div class="rating-container">
                    <div class="rating-item" data-rating="1">
                        
                        <div class="rating-text">ไม่พอใจ (1)</div>
                    </div>
                    <div class="rating-item" data-rating="2">
                      
                        <div class="rating-text">พอใช้ (2)</div>
                    </div>
                    <div class="rating-item" data-rating="3">
                       
                        <div class="rating-text">พอใจ (3)</div>
                    </div>
                    <div class="rating-item" data-rating="4">
                    
                        <div class="rating-text">พอใจมาก (4)</div>
                    </div>
                    <div class="rating-item" data-rating="5">
                       
                        <div class="rating-text">พอใจที่สุด (5)</div>
                    </div>
                </div>
                <input type="hidden" id="satisfaction-rating" required>
            </div>

            <div class="form-section" style="border-bottom: none; padding-bottom: 0;">
                <div class="form-section-title">
                    <i class="fas fa-comment-alt"></i> ข้อเสนอแนะ
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="suggestion">ข้อเสนอแนะเพื่อการปรับปรุง (ไม่บังคับ)</label>
                    <textarea id="suggestion" class="form-textarea" placeholder="กรอกข้อเสนอแนะเกี่ยวกับการใช้ห้องสมุด"></textarea>
                </div>
            </div>

            <div style="text-align: center; margin-top: 2rem;">
                <button type="submit" class="action-btn" style="width: 100%; max-width: 300px;">
                    <i class="fas fa-check-circle"></i> ส่งแบบสำรวจ
                </button>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('checkin-survey-form');
            const entryTimeInput = document.getElementById('entry-time');
            const exitTimeInput = document.getElementById('exit-time');
            const durationDisplay = document.getElementById('duration-display');
            const addBookButton = document.getElementById('add-book');
            const bookTitleInput = document.getElementById('book-title');
            const bookListContainer = document.getElementById('book-list');
            const ratingItems = document.querySelectorAll('.rating-item');
            const satisfactionRatingInput = document.getElementById('satisfaction-rating');

            // --- 1. คำนวณระยะเวลา ---
            function calculateDuration() {
                const entryTime = entryTimeInput.value;
                const exitTime = exitTimeInput.value;
                
                if (entryTime && exitTime) {
                    const [entryHours, entryMinutes] = entryTime.split(':').map(Number);
                    const [exitHours, exitMinutes] = exitTime.split(':').map(Number);
                    
                    let totalMinutes = (exitHours * 60 + exitMinutes) - (entryHours * 60 + entryMinutes);
                    
                    // กรณีที่เวลาออกน้อยกว่าเวลาเข้า (เช่น 23:00 ถึง 01:00)
                    if (totalMinutes < 0) {
                        totalMinutes += 24 * 60; // บวก 24 ชั่วโมง
                    }
                    
                    const hours = Math.floor(totalMinutes / 60);
                    const minutes = totalMinutes % 60;
                    
                    durationDisplay.textContent = totalMinutes > 0 ? 
                        `${hours} ชั่วโมง ${minutes} นาที` : 
                        'เวลาออกต้องมากกว่าเวลาเข้า';
                    
                    durationDisplay.style.color = totalMinutes > 0 ? '#56d364' : '#f85149';
                } else {
                    durationDisplay.textContent = 'กรุณากรอกเวลาเข้าและเวลาออก';
                    durationDisplay.style.color = '#c9a8ff';
                }
            }

            entryTimeInput.addEventListener('change', calculateDuration);
            exitTimeInput.addEventListener('change', calculateDuration);

            // --- 2. การจัดการรายการหนังสือ ---
            function addBook(title) {
                const bookItem = document.createElement('div');
                bookItem.className = 'book-item';
                bookItem.innerHTML = `
                    <span style="flex-grow: 1; word-break: break-word;">${title}</span>
                    <div class="book-actions">
                        <button type="button" class="remove-book-btn" title="ลบหนังสือ">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <input type="hidden" name="books[]" value="${title}">
                `;
                bookListContainer.appendChild(bookItem);
                
                // เพิ่ม Listener สำหรับปุ่มลบ
                bookItem.querySelector('.remove-book-btn').addEventListener('click', () => {
                    bookItem.remove();
                });
            }

            addBookButton.addEventListener('click', () => {
                const title = bookTitleInput.value.trim();
                if (title) {
                    addBook(title);
                    bookTitleInput.value = '';
                } else {
                    alert('กรุณากรอกชื่อหนังสือ');
                }
            });

            // --- 3. การเลือกคะแนนความพึงพอใจ ---
            ratingItems.forEach(item => {
                item.addEventListener('click', function() {
                    const ratingValue = this.getAttribute('data-rating');
                    
                    // ลบคลาส 'selected' ออกจากทุกอัน
                    ratingItems.forEach(r => r.classList.remove('selected'));
                    
                    // เพิ่มคลาส 'selected' ให้กับรายการที่เลือก
                    this.classList.add('selected');
                    
                    // ตั้งค่าค่าลงใน hidden input
                    satisfactionRatingInput.value = ratingValue;
                });
            });

            // --- 4. การส่งฟอร์ม (จำลอง) ---
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                
                // ตรวจสอบความสมบูรณ์ของข้อมูลเบื้องต้น
                if (!satisfactionRatingInput.value) {
                    alert('กรุณาเลือกระดับความพึงพอใจ');
                    return;
                }
                
                calculateDuration(); // คำนวณครั้งสุดท้ายก่อนส่ง

                // รวบรวมข้อมูล
                const formData = {
                    entryTime: entryTimeInput.value,
                    exitTime: exitTimeInput.value,
                    duration: durationDisplay.textContent,
                    fullname: document.getElementById('fullname').value,
                    studentId: document.getElementById('student-id').value,
                    year: document.getElementById('year').value,
                    major: document.getElementById('major').value,
                    books: Array.from(document.querySelectorAll('.book-list input[name="books[]"]')).map(input => input.value),
                    satisfaction: satisfactionRatingInput.value,
                    suggestion: document.getElementById('suggestion').value,
                };

                console.log('ข้อมูลที่ส่ง:', formData);
                
                alert('ส่งแบบสำรวจเรียบร้อยแล้ว! (ข้อมูลถูกแสดงใน Console Log)');
                
                // รีเซ็ตฟอร์ม
                form.reset();
                bookListContainer.innerHTML = '';
                ratingItems.forEach(r => r.classList.remove('selected'));
                satisfactionRatingInput.value = '';
                calculateDuration();
            });

        });
    </script>
</body>
</html>